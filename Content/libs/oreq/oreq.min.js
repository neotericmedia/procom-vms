(function(n){function e(n){return n instanceof Array}function b(n){return Object.prototype.toString.call(n)=="[object Number]"}function a(n){return Object.prototype.toString.call(n)=="[object String]"}function i(n){return typeof n=="undefined"}function k(n,t){return i(t)?n instanceof f:n instanceof t}function p(n){return n instanceof s}function w(n){return p(n)?99:a(n)?l[n]||50:l[n.value]||50}function d(n){for(var r,u=[],t=[],f=0;f<n.length;f++)if(r=n[f],r=="(")t.push(r);else if(r==")"){while(t.peek()!="("&&!i(t.peek()))u.push(t.pop());t.pop()}else{while(t.length){var e=t.peek(),o=w(e),s=w(r);if(o>=s)u.push(t.pop());else break}t.push(r)}while(t.length)u.push(t.pop());return u}function g(n){var f,t,i,r,u;if(n&&n.length){for(f=n.join(" "),t=[];n.length;)if(i=n.shift(),i instanceof c)r=t.pop(),u=tt(i,r),t.push(new s(u));else if(i instanceof o){var e=t.pop(),h=t.pop(),l=nt(i,h,e);t.push(new s(l))}else t.push(i);return t.pop().value}}function nt(n,t,i){return n.value=="any"||n.value=="all"?t.value+"/"+n.value+"(x: "+i.value+")":n.value=="substringof"||n.value=="endswith"||n.value=="startswith"?n.value+"("+t.value+","+i.value+")":[t.value,n.value,i.value].join(" ")}function tt(n,t){if(n.value=="year")return n.value+"("+t.value+")"}function it(n,t){var f=n.root,r=[],u=t?function(n){return n}:escape,e;return i(n.expand)||r.push("$expand="+u(n.expand)),i(n.format)||r.push("$format="+u(n.format)),i(n.filter)||r.push("$filter="+u(n.filter)),i(n.orderby)||r.push("$orderby="+u(n.orderby)),i(n.top)||r.push("$top="+u(n.top)),i(n.skip)||r.push("$skip="+u(n.skip)),i(n.select)||r.push("$select="+u(n.select)),i(n.inlinecount)||r.push("$inlinecount="+u(n.inlinecount)),e=r.join("&"),f=f||"",f&&e&&(f+="?"),e&&(f+=e),f}function rt(n,t){var r={root:n.root},u=t?function(n){return n}:escape;return i(n.expand)||(r.$expand=u(n.expand)),i(n.format)||(r.$format=u(n.format)),i(n.filter)||(r.$filter=u(n.filter)),i(n.orderby)||(r.$orderby=u(n.orderby)),i(n.top)||(r.$top=u(n.top)),i(n.skip)||(r.$skip=u(n.skip)),i(n.select)||(r.$select=u(n.select)),i(n.inlinecount)||(r.$inlinecount=u(n.inlinecount)),r}function u(n,t){this.value=t;f.call(this,n);this.addInternal("(");this.addOperand(t)}var h,y,l,v,s,o,c,f,t,r;Array.prototype.peek=function(){return this[this.length-1]};h=function(n,t){var i=function(){};i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=n};y=function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n.prototype[i]=t[i]);return n};n.request=function(n){return new v(n)};n.filter=function(n,t){return new u([],n,t)};l={"(":1};v=function(n){return this.req={root:n},this};v.prototype={withExpand:function(n){return e(n)&&n.length>0?this.req.expand=n.join(","):e(n)||(this.req.expand=n),this},withOrderby:function(n){return e(n)&&n.length>0?this.req.orderby=n.join(","):e(n)||(this.req.orderby=n),this},withFormat:function(n){return this.req.format=n,this},withSkip:function(n){return this.req.skip=n,this},withTop:function(n){return this.req.top=n,this},withFilter:function(n){if(k(n,r))this.req.filter=n.evalInfix();else if(n===null||i(n)||a(n)||b(n))this.req.filter=n;else throw new Error("Invalid filter expression");return this},withInlineCount:function(){return this.req.inlinecount="allpages",this},withSelect:function(n){return e(n)&&n.length>0?this.req.select=n.join(","):e(n)||(this.req.select=n),this},url:function(n){return it(this.req,n)},param:function(n){return rt(this.req,n)}};s=function(n){this.value=n};s.prototype.toString=function(){return"opd:"+this.value};o=function(n){this.value=n};o.prototype.toString=function(){return"opr:"+this.value};c=function(n){o.call(this,n)};c.prototype.toString=function(){return"uopr:"+this.value};h(c,o);f=function(n){this.infix=n;this.field=this};f.prototype.addOperand=function(n){this.infix.push(new s(n))};f.prototype.addOperator=function(n){this.infix.push(new o(n))};f.prototype.addUnaryOperator=function(n){this.infix.push(new c(n))};f.prototype.addInternal=function(n){this.infix.push(n)};f.prototype.addLambda=function(n){if(this.infix.push("("),e(n))for(var t=0;t<n.length;t++)p(n[t])&&(i(n[t].value)?n[t].value="x":a(n[t].value)&&n[t].value.indexOf("/")===0&&(n[t].value="x"+n[t].value));this.infix=this.infix.concat(n);this.infix.push(")")};f.prototype.evalInfix=function(){for(var i,r,t=0,n=0;n<this.infix.length;n++)(this.infix[n]=="("||this.infix[n]==")")&&t++;return t%2!=0&&this.addInternal(")"),i=d(this.infix),r=g(i),r};t=function(n){f.call(this,n)};h(t,f);t.prototype.eq=function(n){return this.addOperator("eq"),this.addOperand(n),new r(this.infix)};t.prototype.ne=function(n){return this.addOperator("ne"),this.addOperand(n),new r(this.infix)};t.prototype.gt=function(n){return this.addOperator("gt"),this.addOperand(n),new r(this.infix)};t.prototype.ge=function(n){return this.addOperator("ge"),this.addOperand(n),new r(this.infix)};t.prototype.lt=function(n){return this.addOperator("lt"),this.addOperand(n),new r(this.infix)};t.prototype.le=function(n){return this.addOperator("le"),this.addOperand(n),new r(this.infix)};t.prototype.not=function(n){return this.addOperator("not"),this.addOperand(n),new r(this.infix)};t.prototype.add=function(n){return this.addOperator("add"),this.addOperand(n),new t(this.infix)};t.prototype.sub=function(n){return this.addOperator("sub"),this.addOperand(n),new t(this.infix)};t.prototype.mul=function(n){return this.addOperator("mul"),this.addOperand(n),new t(this.infix)};t.prototype.div=function(n){return this.addOperator("div"),this.addOperand(n),new t(this.infix)};t.prototype.mod=function(n){return this.addOperator("mod"),this.addOperand(n),new t(this.infix)};r=function(n){f.call(this,n)};h(r,t);r.prototype.filter=function(n,t){return new u(this.infix,n,t)};r.prototype.and=function(){return this.addInternal(")"),this.addOperator("and"),new r(this.infix)};r.prototype.or=function(){return this.addInternal(")"),this.addOperator("or"),new r(this.infix)};h(u,t);u.prototype.any=function(n){return this.addOperator("any"),this.addLambda(n.infix),this.addInternal(")"),new r(this.infix)};u.prototype.all=function(n){return this.addOperator("all"),this.addLambda(n),this.addInternal(")"),new r(this.infix)};u.prototype.year=function(){return this.addUnaryOperator("year"),new t(this.infix)};u.prototype.month=function(){return this.addUnaryOperator("month"),new t(this.infix)};u.prototype.day=function(){return this.addUnaryOperator("day"),new t(this.infix)};u.prototype.hour=function(){return this.addUnaryOperator("hour"),new t(this.infix)};u.prototype.minute=function(){return this.addUnaryOperator("minute"),new t(this.infix)};u.prototype.second=function(){return this.addUnaryOperator("second"),new t(this.infix)};u.prototype.substringOf=function(n){return this.addOperator("substringof"),this.addOperand(n),this.addInternal(")"),new r(this.infix)};u.prototype.endsWith=function(n){return this.addOperator("endswith"),this.addOperand(n),this.addInternal(")"),new r(this.infix)};u.prototype.startsWith=function(n){return this.addOperator("startswith"),this.addOperand(n),this.addInternal(")"),new r(this.infix)};u.prototype.indexOf=function(n){return this.addOperator("indexof"),this.addOperand(n),this.addInternal(")"),new t(this.infix)};n.filterMixin=function(n){y(u,n)};n.filterMixin({eqOr:function(n){var t=oreq,i;if(e(n))for(i=0;i<n.length;i++)t=t.filter(this.value).eq(n[i]),n.length!=i+1&&t.or();else n&&(t=t.filter(this.value).eq(n));return t},yearEqOr:function(n){var t=oreq,i;if(e(n))for(i=0;i<n.length;i++)t=t.filter(this.value).year().eq(n[i]),n.length!=i+1&&t.or();else n&&(t=t.filter(this.value).year().eq(n));return t},anyOr:function(n,t){var i=oreq,r;if(e(n))for(r=0;r<n.length;r++)i=i.filter(t).eq(n[r]),n.length!=r+1&&i.or();else n&&(i=i.filter(t).eq(n));return this.any(i)},anyYearOr:function(n,t){var i=oreq,r;if(e(n))for(r=0;r<n.length;r++)i=i.filter(t).year().eq(n[r]),n.length!=r+1&&i.or();else n&&(i=i.filter(t).year().eq(n));return this.any(i)}})})(typeof exports=="undefined"?this.oreq={}:exports);
/*
//# sourceMappingURL=oreq.min.js.map
*/